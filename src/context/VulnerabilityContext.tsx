import React, { createContext, useContext, useState, useEffect } from 'react';

interface Vulnerability {
  id: string;
  cveId: string;
  description: string;
  severity: 'critical' | 'high' | 'medium' | 'low';
  cvssScore: number;
  affectedDevice: string;
  oem: string;
  department: string;
  patientSafetyImpact: 'life-critical' | 'high' | 'medium' | 'low';
  hipaaRisk: 'high' | 'medium' | 'low';
  publishedDate: string;
  remediation?: string;
}

interface MedicalDevice {
  id: string;
  name: string;
  model: string;
  manufacturer: string;
  category: 'Critical Care' | 'Diagnostic' | 'Treatment' | 'IT Systems';
  location: string;
  status: 'online' | 'offline' | 'warning' | 'critical';
  vulnerabilityCount: number;
  lastUpdated: string;
}

interface VulnerabilityContextType {
  vulnerabilities: Vulnerability[];
  medicalDevices: MedicalDevice[];
  criticalAlerts: number;
  totalDevices: number;
  complianceScore: number;
}

const VulnerabilityContext = createContext<VulnerabilityContextType | undefined>(undefined);

export const useVulnerability = () => {
  const context = useContext(VulnerabilityContext);
  if (!context) {
    throw new Error('useVulnerability must be used within a VulnerabilityProvider');
  }
  return context;
};

const sampleVulnerabilities: Vulnerability[] = [
  {
    id: '1',
    cveId: 'CVE-2024-1234',
    description: 'Remote code execution vulnerability in network interface affecting ICU patient monitoring capabilities and real-time vital sign transmission',
    severity: 'critical',
    cvssScore: 9.8,
    affectedDevice: 'IntelliVue Patient Monitor MX800',
    oem: 'Philips Healthcare',
    department: 'icu',
    patientSafetyImpact: 'life-critical',
    hipaaRisk: 'high',
    publishedDate: '2024-03-10T10:30:00Z',
    remediation: 'Apply firmware update v4.2.1 immediately. Isolate affected devices on dedicated VLAN until patched. Contact Philips support for emergency patch deployment.'
  },
  {
    id: '2',
    cveId: 'CVE-2024-5678',
    description: 'Authentication bypass in DICOM server component allowing unauthorized access to medical imaging data and patient radiological records',
    severity: 'high',
    cvssScore: 8.2,
    affectedDevice: 'Discovery MR750w MRI Scanner',
    oem: 'GE Healthcare',
    department: 'radiology',
    patientSafetyImpact: 'medium',
    hipaaRisk: 'high',
    publishedDate: '2024-03-08T14:15:00Z',
    remediation: 'Update DICOM server software to version 3.1.4. Implement additional network segmentation for imaging systems. Review access logs for potential unauthorized access.'
  },
  {
    id: '3',
    cveId: 'CVE-2024-9101',
    description: 'Wireless communication vulnerability in insulin delivery system allowing potential manipulation of dosage settings and therapy parameters',
    severity: 'critical',
    cvssScore: 9.1,
    affectedDevice: 'MiniMed 780G Insulin Pump',
    oem: 'Medtronic',
    department: 'endocrinology',
    patientSafetyImpact: 'life-critical',
    hipaaRisk: 'medium',
    publishedDate: '2024-03-07T09:45:00Z',
    remediation: 'Disable wireless connectivity until patch available. Revert to manual monitoring mode. Contact Medtronic for emergency replacement devices if needed.'
  },
  {
    id: '4',
    cveId: 'CVE-2024-1122',
    description: 'SQL injection vulnerability in patient data module allowing unauthorized access to electronic health records and personal health information',
    severity: 'high',
    cvssScore: 8.8,
    affectedDevice: 'Epic EHR System',
    oem: 'Epic Systems',
    department: 'it',
    patientSafetyImpact: 'medium',
    hipaaRisk: 'high',
    publishedDate: '2024-03-05T16:20:00Z',
    remediation: 'Apply security patch SP-2024-03 immediately. Conduct database integrity check. Review audit logs for suspicious query patterns. Notify patients if data access suspected.'
  },
  {
    id: '5',
    cveId: 'CVE-2024-3344',
    description: 'Buffer overflow in drug library management system affecting medication delivery accuracy and dosage calculations for critical care patients',
    severity: 'critical',
    cvssScore: 9.4,
    affectedDevice: 'Alaris Infusion Pump',
    oem: 'Baxter International',
    department: 'icu',
    patientSafetyImpact: 'life-critical',
    hipaaRisk: 'low',
    publishedDate: '2024-03-04T11:30:00Z',
    remediation: 'Immediately update drug library to version 2.4.7. Verify all current infusion parameters. Implement dual-verification protocols for high-risk medications until patch deployment.'
  },
  {
    id: '6',
    cveId: 'CVE-2024-2468',
    description: 'Unauthorized privilege escalation in surgical navigation system potentially compromising surgical precision and patient safety during procedures',
    severity: 'high',
    cvssScore: 7.9,
    affectedDevice: 'da Vinci Surgical System',
    oem: 'Intuitive Surgical',
    department: 'surgery',
    patientSafetyImpact: 'high',
    hipaaRisk: 'medium',
    publishedDate: '2024-03-03T13:10:00Z',
    remediation: 'Install system update 5.2.1 during next maintenance window. Conduct calibration verification before each procedure. Maintain backup conventional surgical capabilities.'
  },
  {
    id: '7',
    cveId: 'CVE-2024-1357',
    description: 'Cross-site scripting vulnerability in laboratory information system web interface allowing potential manipulation of test results and patient data',
    severity: 'medium',
    cvssScore: 6.4,
    affectedDevice: 'COBAS IT 1000 Laboratory System',
    oem: 'Roche Diagnostics',
    department: 'laboratory',
    patientSafetyImpact: 'medium',
    hipaaRisk: 'medium',
    publishedDate: '2024-03-02T08:45:00Z',
    remediation: 'Apply web interface security patch 1.8.3. Implement content security policy headers. Train staff on recognizing suspicious interface behavior.'
  },
  {
    id: '8',
    cveId: 'CVE-2024-8642',
    description: 'Firmware vulnerability in dialysis machine control system affecting fluid balance calculations and treatment parameter monitoring',
    severity: 'high',
    cvssScore: 8.3,
    affectedDevice: '5008S Hemodialysis Machine',
    oem: 'Fresenius Medical Care',
    department: 'nephrology',
    patientSafetyImpact: 'high',
    hipaaRisk: 'low',
    publishedDate: '2024-03-01T15:25:00Z',
    remediation: 'Update machine firmware to version 7.1.2. Calibrate fluid sensors after update. Implement enhanced patient monitoring during treatment sessions.'
  }
];

const sampleMedicalDevices: MedicalDevice[] = [
  {
    id: '1',
    name: 'IntelliVue Patient Monitor MX800',
    model: 'MX800',
    manufacturer: 'Philips Healthcare',
    category: 'Critical Care',
    location: 'ICU - Room 301',
    status: 'critical',
    vulnerabilityCount: 1,
    lastUpdated: '2024-03-10T10:30:00Z'
  },
  {
    id: '2',
    name: 'Discovery MR750w MRI Scanner',
    model: 'MR750w',
    manufacturer: 'GE Healthcare',
    category: 'Diagnostic',
    location: 'Radiology - Suite 2',
    status: 'warning',
    vulnerabilityCount: 1,
    lastUpdated: '2024-03-08T14:15:00Z'
  },
  {
    id: '3',
    name: 'MiniMed 780G Insulin Pump',
    model: '780G',
    manufacturer: 'Medtronic',
    category: 'Treatment',
    location: 'Endocrinology - Patient Room',
    status: 'critical',
    vulnerabilityCount: 1,
    lastUpdated: '2024-03-07T09:45:00Z'
  },
  {
    id: '4',
    name: 'Epic EHR System',
    model: 'MyChart 2024',
    manufacturer: 'Epic Systems',
    category: 'IT Systems',
    location: 'Data Center - Server Room',
    status: 'warning',
    vulnerabilityCount: 1,
    lastUpdated: '2024-03-05T16:20:00Z'
  },
  {
    id: '5',
    name: 'Alaris Infusion Pump',
    model: 'PC Unit 8015',
    manufacturer: 'Baxter International',
    category: 'Critical Care',
    location: 'ICU - Room 305',
    status: 'critical',
    vulnerabilityCount: 1,
    lastUpdated: '2024-03-04T11:30:00Z'
  },
  {
    id: '6',
    name: 'da Vinci Surgical System',
    model: 'Xi Surgical Robot',
    manufacturer: 'Intuitive Surgical',
    category: 'Treatment',
    location: 'Operating Room 3',
    status: 'warning',
    vulnerabilityCount: 1,
    lastUpdated: '2024-03-03T13:10:00Z'
  },
  {
    id: '7',
    name: 'COBAS IT 1000 Laboratory System',
    model: 'IT 1000',
    manufacturer: 'Roche Diagnostics',
    category: 'Diagnostic',
    location: 'Laboratory - Main Lab',
    status: 'online',
    vulnerabilityCount: 1,
    lastUpdated: '2024-03-02T08:45:00Z'
  },
  {
    id: '8',
    name: '5008S Hemodialysis Machine',
    model: '5008S',
    manufacturer: 'Fresenius Medical Care',
    category: 'Treatment',
    location: 'Dialysis Unit - Bay 4',
    status: 'warning',
    vulnerabilityCount: 1,
    lastUpdated: '2024-03-01T15:25:00Z'
  },
  {
    id: '9',
    name: 'Ventilator PB980',
    model: 'PB980',
    manufacturer: 'Medtronic',
    category: 'Critical Care',
    location: 'ICU - Room 302',
    status: 'online',
    vulnerabilityCount: 0,
    lastUpdated: '2024-03-10T12:00:00Z'
  },
  {
    id: '10',
    name: 'CT Scanner Revolution',
    model: 'Revolution CT',
    manufacturer: 'GE Healthcare',
    category: 'Diagnostic',
    location: 'Radiology - Suite 1',
    status: 'online',
    vulnerabilityCount: 0,
    lastUpdated: '2024-03-09T16:30:00Z'
  }
];

export const VulnerabilityProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [vulnerabilities] = useState<Vulnerability[]>(sampleVulnerabilities);
  const [medicalDevices] = useState<MedicalDevice[]>(sampleMedicalDevices);
  
  const criticalAlerts = vulnerabilities.filter(v => v.severity === 'critical').length;
  const totalDevices = medicalDevices.length;
  const complianceScore = 92;

  const value = {
    vulnerabilities,
    medicalDevices,
    criticalAlerts,
    totalDevices,
    complianceScore
  };

  return (
    <VulnerabilityContext.Provider value={value}>
      {children}
    </VulnerabilityContext.Provider>
  );
};